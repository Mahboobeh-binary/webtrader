!function(a){"object"==typeof module&&module.exports?module.exports=a:a(Highcharts)}(function(a){"use strict";function b(b,c,d,f,g){var h,i,j,k=(b.options.exporting||{}).csv||{},l=k.url||"http://www.highcharts.com/studies/csv-export/download.php";j=b.options.exporting.filename?b.options.exporting.filename:b.title?b.title.textStr.replace(/ /g,"-").toLowerCase():"chart",window.Blob&&window.navigator.msSaveOrOpenBlob?(i=new Blob([f]),window.navigator.msSaveOrOpenBlob(i,j+"."+d)):e?(h=document.createElement("a"),h.href=c,h.target="_blank",h.download=j+"."+d,document.body.appendChild(h),h.click(),h.remove()):a.post(l,{data:f,type:g,extension:d})}var c=a.each,d=a.pick,e=void 0!==document.createElement("a").download;a.setOptions({lang:{downloadCSV:"Download CSV",downloadXLS:"Download XLS"}}),a.Chart.prototype.getDataRows=function(){var b,e,f,g=(this.options.exporting||{}).csv||{},h=this.xAxis[0],i={},j=[],k=[],l=h.options.title&&h.options.title.text,m=g.dateFormat||"%Y-%m-%d %H:%M:%S",n=g.columnHeaderFormatter||function(a,b,c){return a.name+(c>1?" ("+b+")":"")};e=0,c(this.series,function(a){var b,f=a.options.keys,g=f||a.pointArrayMap||["y"],h=g.length,j=a.requireSorting,l={};if(c(g,function(b){l[b]=a[b+"Axis"]&&a[b+"Axis"].categories||[]}),a.options.includeInCSVExport!==!1&&a.visible!==!1){for(b=0;h>b;)k.push(n(a,g[b],g.length)),b+=1;c(a.points,function(c,f){var k,m,n=j?c.x:f;for(b=0,i[n]||(i[n]=[]),i[n].x=c.x,a.xAxis||(i[n].name=c.name);h>b;)k=g[b],m=c[k],i[n][e+b]=d(l[k][m],m),b+=1}),e+=b}});for(f in i)i.hasOwnProperty(f)&&j.push(i[f]);return j.sort(function(a,b){return a.x-b.x}),l||(l=h.isDatetimeAxis?"DateTime":"Category"),b=[[l].concat(k)],c(j,function(c){var e=c.name;e||(e=h.isDatetimeAxis?a.dateFormat(m,c.x):h.categories?d(h.names[c.x],h.categories[c.x],c.x):c.x),c.unshift(e),b.push(c)}),b},a.Chart.prototype.getCSV=function(a){var b="",d=this.getDataRows(),e=(this.options.exporting||{}).csv||{},f=e.itemDelimiter||",",g=e.lineDelimiter||"\n";return c(d,function(c,e){for(var h="",i=c.length,j=a?1.1.toLocaleString()[1]:".";i--;)h=c[i],"string"==typeof h&&(h='"'+h+'"'),"number"==typeof h&&","===j&&(h=h.toString().replace(".",",")),c[i]=h;b+=c.join(f),e<d.length-1&&(b+=g)}),b},a.Chart.prototype.getTable=function(a){var b="<table>",d=this.getDataRows();return c(d,function(c,d){var e,f,g=d?"td":"th",h=a?1.1.toLocaleString()[1]:".";for(b+="<tr>",f=0;f<c.length;f+=1)e=c[f],"number"==typeof e?(e=e.toString(),","===h&&(e=e.replace(".",h)),b+="<"+g+' class="number">'+e+"</"+g+">"):b+="<"+g+">"+(void 0===e?"":e)+"</"+g+">";b+="</tr>"}),b+="</table>"},a.Chart.prototype.downloadCSV=function(){var a=this.getCSV(!0);b(this,"data:text/csv,"+a.replace(/\n/g,"%0A"),"csv",a,"text/csv")},a.Chart.prototype.downloadXLS=function(){var a="data:application/vnd.ms-excel;base64,",c='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Ark1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>td{border:none;font-family: Calibri, sans-serif;} .number{mso-number-format:"0.00";}</style><meta name=ProgId content=Excel.Sheet></head><body>'+this.getTable(!0)+"</body></html>",d=function(a){return window.btoa(unescape(encodeURIComponent(a)))};b(this,a+d(c),"xls",c,"application/vnd.ms-excel")},a.getOptions().exporting&&a.getOptions().exporting.buttons.contextButton.menuItems.push({textKey:"downloadCSV",onclick:function(){this.downloadCSV()}},{textKey:"downloadXLS",onclick:function(){this.downloadXLS()}})});