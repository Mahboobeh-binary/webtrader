define(["jquery","windows/windows","websockets/binary_websockets","lodash","datatables","jquery-growl"],function(a,b,c,d){function e(a){require(["css!statement/statement.css"]),require(["text!statement/statement.html"]),a.click(function(){i?i.moveToTop():c.cached.authorize().then(g)["catch"](function(a){})})}function f(b){var e=a("#"+j.attr("id")+"_processing").css("top","200px").show();l=!0;var f={statement:1,description:1};if("string"==typeof b){f.date_from=yyyy_mm_dd_to_epoch(b,{utc:!0});var g=Date.UTC(1970,0,1,23,59,59)/1e3;f.date_to=f.date_from+g,j.api().rows().remove(),m=!0}else f.limit=50,(m||b.clear)&&(j.api().rows().remove(),m=!1),f.offset=j.api().column(0).data().length;var h=function(a){var b=a.statement&&a.statement.transactions||[],c=b.map(function(a){var b=1*a.amount,c=b>0?"up":0>b?"down":"equal",e='<img class="arrow" src="images/'+c+'-arrow.svg"/>';return[epoch_to_string(a.transaction_time,{utc:!0}),a.transaction_id,d.capitalize(a.action_type),e+a.longcode,(1*a.amount).toFixed(2),"<b>"+formatPrice(a.balance_after)+"</b>",a]});j.api().rows.add(c),j.api().draw(),l=!1,e.hide()};c.send(f).then(h)["catch"](function(b){h({}),a.growl.error({message:b.message})})}function g(){i=b.createBlankWindow(a("<div/>"),{title:"Statement",width:700,minHeight:100,destroy:function(){j&&j.DataTable().destroy(!0),i=null},refresh:function(){k.clear(),f({clear:!0})},"data-authorized":"true"}),require(["text!statement/statement.html"],function(b){j=a(b),j.appendTo(i),j=j.dataTable({data:[],columnDefs:[{targets:4,createdCell:function(b,c){var d=0>c?"red":c>0?"green":"bold";d&&a(b).addClass(d)}}],paging:!1,ordering:!1,searching:!0,processing:!0}),j.parent().addClass("hide-search-input"),j.api().columns().every(function(){var b=this;a("input",this.header()).on("keyup change",function(){b.search()!==this.value&&b.search(this.value).draw()})}),k=i.addDateToHeader({title:"Jump to: ",date:null,changed:f,cleared:f}),i.on("click",h),i.dialog("open"),f({clear:!0}),i.scroll(function(){var a=i.scrollTop(),b=i.innerHeight(),c=i[0].scrollHeight,d=(a+b)/c;d>.75&&!l&&!m&&f({clear:!1})})})}function h(a){if("IMG"===a.target.tagName){var b=a.target.parentElement.parentElement,c=j.api().row(b).data(),e=d.last(c);require(["viewtransaction/viewTransaction"],function(a){a.init(e.contract_id,e.transaction_id)})}}var i=null,j=null,k=null,l=!1,m=!1;return{init:e}});